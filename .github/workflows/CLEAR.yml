name: Clear All Releases

on:
  workflow_dispatch:  # 手动触发

jobs:
  delete-releases:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install PyGithub
        run: pip install PyGithub

      - name: Delete all releases
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # 自动生成的token，有repo权限
        run: |
          from github import Github
          import os

          g = Github(os.getenv('GITHUB_TOKEN'))
          repo = g.get_repo(os.getenv('GITHUB_REPOSITORY'))  # 格式: owner/repo

          # 删除所有release
          for release in repo.get_releases():
              print(f"Deleting release: {release.title} (ID: {release.id})")
              release.delete_release()

          print("All releases have been deleted.")